{"filter":false,"title":"user.js","tooltip":"/server/models/user.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":148,"column":82},"end":{"row":148,"column":96},"action":"insert","lines":["where \"id\"<>$3"]},{"start":{"row":159,"column":63},"end":{"row":159,"column":64},"action":"remove","lines":["'"]},{"start":{"row":159,"column":63},"end":{"row":159,"column":94},"action":"insert","lines":["where \"id\"<>$1',[loggedUser.id]"]},{"start":{"row":165,"column":50},"end":{"row":165,"column":65},"action":"insert","lines":[", loggedUser.id"]},{"start":{"row":171,"column":11},"end":{"row":174,"column":35},"action":"remove","lines":["//usersList.data = new Array();","        \t  //usersList.data.push(arrUsrs);","        \t  usersList.data = arrUsrs;","        \t  //console.log(usersList)"]},{"start":{"row":171,"column":11},"end":{"row":171,"column":35},"action":"insert","lines":["usersList.data = arrUsrs"]},{"start":{"row":180,"column":50},"end":{"row":180,"column":65},"action":"insert","lines":[", loggedUser.id"]},{"start":{"row":186,"column":0},"end":{"row":188,"column":0},"action":"remove","lines":["        \t  //usersList.data = new Array();","        \t  //usersList.data.push(arrUsrs);",""]},{"start":{"row":188,"column":0},"end":{"row":189,"column":0},"action":"remove","lines":["        \t  //console.log(usersList);",""]},{"start":{"row":191,"column":4},"end":{"row":221,"column":9},"action":"insert","lines":["}      ","    });","  },","  ","  /****************************************************************************","  * getFriends list","  *","  * Result:","      (array)(array) - Массив с пользователями","  */","  getFriends: function(callback) {","    ","    var usersList = { data: [{}] };","    ","    pg.connect(database.url_pg, function(err, client, done) {","      if(err){console.log(err); return usersList}","      ","      var querySelect = 'SELECT \"Users\".id, \"Users\".username, \"Users\".email, \"Users\".\"visibleProfile\", \"UserFriends\".\"Status\" \\","                        FROM public.\"UserFriends\" left join public.\"Users\" on \"Users\".id = \"UserFriends\".\"FriendId\" \\","                        WHERE \"UserFriends\".\"UserId\" = $1';","      ","      //получаем список","      client.query(querySelect,[loggedUser.id], function(err, result){","    \t  if(err) {callback(errors.restStat_DbReadError, err, usersList); return usersList}","    \t  ","    \t  var arrUsrs = result.rows.map(function(object) { ","        \t    return { id: object.id, username: object.username, email: object.email, img:'avtr' + object.id + '.png', status:object.Status };","        \t  });","        \t  usersList.data = arrUsrs;","        \t  done();","        \t"]},{"start":{"row":221,"column":11},"end":{"row":221,"column":13},"action":"remove","lines":["//"]},{"start":{"row":222,"column":0},"end":{"row":223,"column":2},"action":"insert","lines":["        \t  return usersList;","  "]},{"start":{"row":223,"column":7},"end":{"row":224,"column":0},"action":"insert","lines":[");",""]},{"start":{"row":224,"column":4},"end":{"row":224,"column":6},"action":"remove","lines":["  "]},{"start":{"row":224,"column":4},"end":{"row":225,"column":4},"action":"insert","lines":["});","  },"]},{"start":{"row":226,"column":2},"end":{"row":227,"column":0},"action":"insert","lines":["",""]},{"start":{"row":227,"column":2},"end":{"row":228,"column":4},"action":"remove","lines":["});","  },"]},{"start":{"row":227,"column":2},"end":{"row":257,"column":2},"action":"insert","lines":["/*","  * addFriend","  * Добавляет пользователя в список друзей со статусом \"заявка\"","  * По идеи, нужно когда другой пользователь подтверждает, здесь же организовать эту логику","  * id - id пользователя которого хотят добавить","  * Result:","  * (boolean)","  */","  addFriend: function(friendId){","    ","    pg.connect(database.url_pg, function(err, client, done) {","      if(err){console.log(err); return false}","      ","      var queryInsert = 'INSERT INTO \"UserFriends\"(\"UserId\", \"FriendId\", \"Status\") VALUES ($1, $2, $3);';","      ","      //добавляем друга","      client.query('BEGIN', function(err){","    \t  if(err) {rollback(client, done); return false}","    \t        ","    \t  client.query(queryInsert, [loggedUser.id, friendId, 0], function(err, result) {","      \t  if(err) { console.log(err); rollback(client, done); return false }","      \t  ","      \t  client.query('COMMIT');","          done();","          return true;","    \t  });","      });","    });","    ","  },","  "]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":2973.5,"scrollleft":0,"selection":{"start":{"row":252,"column":7},"end":{"row":252,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":52,"mode":"ace/mode/javascript"}},"hash":"49b9b43bf1bf220665ad8d3b95acbc0667ed803e"}