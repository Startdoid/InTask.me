{"filter":false,"title":"user.js","tooltip":"/server/models/user.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":113,"column":27},"end":{"row":113,"column":28},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":34},"end":{"row":113,"column":35},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":20},"end":{"row":97,"column":32},"action":"remove","lines":["{ data: [] }"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":20},"end":{"row":97,"column":21},"action":"insert","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":21},"end":{"row":97,"column":22},"action":"insert","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":112,"column":10},"end":{"row":113,"column":0},"action":"insert","lines":["",""]},{"start":{"row":113,"column":0},"end":{"row":113,"column":7},"action":"insert","lines":["    \t  "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":7},"end":{"row":113,"column":21},"action":"insert","lines":["usersList.data"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":21},"end":{"row":113,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":22},"end":{"row":113,"column":23},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":23},"end":{"row":113,"column":24},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":24},"end":{"row":113,"column":26},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":26},"end":{"row":113,"column":27},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":114,"column":36},"end":{"row":115,"column":0},"action":"insert","lines":["",""]},{"start":{"row":115,"column":0},"end":{"row":115,"column":7},"action":"insert","lines":["    \t  "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":7},"end":{"row":115,"column":8},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":8},"end":{"row":115,"column":9},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":9},"end":{"row":115,"column":10},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":7},"end":{"row":115,"column":10},"action":"remove","lines":["con"]},{"start":{"row":115,"column":7},"end":{"row":115,"column":14},"action":"insert","lines":["console"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":14},"end":{"row":115,"column":15},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":15},"end":{"row":115,"column":16},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":15},"end":{"row":115,"column":17},"action":"remove","lines":["lo"]},{"start":{"row":115,"column":15},"end":{"row":115,"column":20},"action":"insert","lines":["log()"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":19},"end":{"row":115,"column":21},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":19},"end":{"row":115,"column":21},"action":"remove","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":19},"end":{"row":115,"column":20},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":20},"end":{"row":115,"column":21},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":19},"end":{"row":115,"column":21},"action":"remove","lines":["us"]},{"start":{"row":115,"column":19},"end":{"row":115,"column":28},"action":"insert","lines":["usersList"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":29},"end":{"row":115,"column":30},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":21},"end":{"row":97,"column":22},"action":"remove","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":20},"end":{"row":97,"column":21},"action":"remove","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":24},"end":{"row":113,"column":26},"action":"remove","lines":["[]"]},{"start":{"row":113,"column":24},"end":{"row":113,"column":25},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":25},"end":{"row":113,"column":26},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":26},"end":{"row":113,"column":27},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":27},"end":{"row":113,"column":28},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":28},"end":{"row":113,"column":29},"action":"insert","lines":["A"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":29},"end":{"row":113,"column":30},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":30},"end":{"row":113,"column":31},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":28},"end":{"row":113,"column":31},"action":"remove","lines":["Arr"]},{"start":{"row":113,"column":28},"end":{"row":113,"column":33},"action":"insert","lines":["Array"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":33},"end":{"row":113,"column":35},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":17},"end":{"row":97,"column":18},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":18},"end":{"row":97,"column":19},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":19},"end":{"row":97,"column":20},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":20},"end":{"row":97,"column":21},"action":"insert","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":21},"end":{"row":97,"column":22},"action":"insert","lines":["}"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":21},"end":{"row":97,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":22},"end":{"row":97,"column":23},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":23},"end":{"row":97,"column":24},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":24},"end":{"row":97,"column":25},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":25},"end":{"row":97,"column":26},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":26},"end":{"row":97,"column":27},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":27},"end":{"row":97,"column":28},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":28},"end":{"row":97,"column":30},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":29},"end":{"row":97,"column":31},"action":"insert","lines":["{}"]}]}],[{"group":"doc","deltas":[{"start":{"row":97,"column":32},"end":{"row":97,"column":33},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":7},"end":{"row":113,"column":8},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":8},"end":{"row":113,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":8},"end":{"row":113,"column":9},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":7},"end":{"row":113,"column":8},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":7},"end":{"row":113,"column":8},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":113,"column":8},"end":{"row":113,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":114,"column":7},"end":{"row":114,"column":8},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":114,"column":8},"end":{"row":114,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":114,"column":38},"end":{"row":115,"column":0},"action":"insert","lines":["",""]},{"start":{"row":115,"column":0},"end":{"row":115,"column":7},"action":"insert","lines":["    \t  "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":7},"end":{"row":115,"column":16},"action":"insert","lines":["usersList"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":17},"end":{"row":115,"column":18},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":18},"end":{"row":115,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":18},"end":{"row":115,"column":19},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":17},"end":{"row":115,"column":18},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":16},"end":{"row":115,"column":17},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":17},"end":{"row":115,"column":21},"action":"insert","lines":["data"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":21},"end":{"row":115,"column":22},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":22},"end":{"row":115,"column":23},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":23},"end":{"row":115,"column":24},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":24},"end":{"row":115,"column":25},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":25},"end":{"row":115,"column":26},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":24},"end":{"row":115,"column":26},"action":"remove","lines":["ar"]},{"start":{"row":115,"column":24},"end":{"row":115,"column":31},"action":"insert","lines":["arrUsrs"]}]}],[{"group":"doc","deltas":[{"start":{"row":115,"column":31},"end":{"row":115,"column":32},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":108,"column":47},"end":{"row":108,"column":49},"action":"remove","lines":["10"]},{"start":{"row":108,"column":47},"end":{"row":108,"column":48},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":116,"column":7},"end":{"row":116,"column":8},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":116,"column":8},"end":{"row":116,"column":9},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":110},"end":{"row":111,"column":111},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":109},"end":{"row":111,"column":110},"action":"remove","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":108},"end":{"row":111,"column":109},"action":"remove","lines":["j"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":108},"end":{"row":111,"column":109},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":109},"end":{"row":111,"column":110},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":111,"column":110},"end":{"row":111,"column":111},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":108,"column":47},"end":{"row":108,"column":48},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":108,"column":47},"end":{"row":108,"column":48},"action":"insert","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":9},"end":{"row":0,"column":18},"action":"insert","lines":["         "]},{"start":{"row":1,"column":13},"end":{"row":1,"column":18},"action":"insert","lines":["     "]},{"start":{"row":4,"column":0},"end":{"row":5,"column":0},"action":"insert","lines":["<<<<<<< HEAD",""]},{"start":{"row":5,"column":43},"end":{"row":8,"column":48},"action":"insert","lines":["","=======","var database \t\t\t= require('../database'); //Чтение настроек подключения к ИБ ",">>>>>>> 3e2fc665fb6b10cb1adca17386c101928671a8c0"]},{"start":{"row":68,"column":0},"end":{"row":88,"column":0},"action":"insert","lines":["var rollback = function(client, done) {","  client.query('ROLLBACK', function(err) {","    //if there was a problem rolling back the query","    //something is seriously messed up.  Return the error","    //to the done function to close & remove this client from","    //the pool.  If you leave a client in the pool with an unaborted","    //transaction weird, hard to diagnose problems might happen.","    return done(err);","  });","};","","var commit = function(client, callback) {","    ","    // commit","    client.query('COMMIT');","    done();","    return callback(validationResult.status);","};","","",""]},{"start":{"row":163,"column":0},"end":{"row":168,"column":0},"action":"insert","lines":["  ","  /*","  * saveLoggedUserFromBody  записываем информацию о пользователи","  *","  */",""]},{"start":{"row":176,"column":6},"end":{"row":176,"column":13},"action":"insert","lines":["//mongo"]},{"start":{"row":185,"column":0},"end":{"row":234,"column":0},"action":"insert","lines":["      ","      //postgres","      pg.connect(database.url_pg, function(err, client, done) {","\t   \tif(err) {","    \t\tconsole.log('connection error (Postgres):'+err);","    \t\treturn;","    \t}","    \t","    \t//запросы","    \tvar querySelect = 'SELECT id FROM \"Users\" WHERE \"id\"=$1;';","    \tvar queryUpdate = 'UPDATE \"Users\" SET \"username\"=$1, \"email\"=$2, \"visibleProfile\"=$3 WHERE \"id\"=$4;';","    \tvar queryInsert = 'INSERT INTO \"Users\"(\"id\", \"username\", \"email\", \"visibleProfile\") VALUES ($1, $2, $3, $4);';","    \t","    \t//trqansaction","    \tclient.query('BEGIN', function(err){","    \t  if(err) return rollback(client, done);","    \t  ","    \t  //проверяем существует или нет","    \t  var modeUpdate = false;","    \t  client.query(querySelect,[body['id']], function(err, result){","    \t    if(err) return rollback(client,done);","    \t    if(result.rowCount>=1) modeUpdate = true;","    \t    ","    \t    if(modeUpdate){","    \t    // обновляем","      \t  client.query(queryUpdate,[body['username'], body['email'], body['permissionVisibleProfile'], body['id']], function(err){","      \t    if(err) return rollback(client,done);","      \t    ","              // commit","              client.query('COMMIT');","              done();","              return callback(validationResult.status);","      \t  });","      \t  }else{","      \t  ","        \t  // вставляем","        \t  client.query(queryInsert, [body['id'], body['username'], body['email'], body['permissionVisibleProfile']], function(err){","        \t    if(err) return rollback(client,done);","          \t     // commit","                client.query('COMMIT');","                done();","                return callback(validationResult.status);","      \t    });","      \t  }","    \t  });","    \t  ","    \t});","    \t","    });",""]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":2244,"scrollleft":0,"selection":{"start":{"row":143,"column":8},"end":{"row":143,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":186,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1422352161201,"hash":"10ba17740d9f782872a454cdc07d79127418cfa3"}